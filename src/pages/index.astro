---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import MainCard from "@/components/MainCard.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import imageLiang from "@/assets/image/home.avif";

// 获取所有博客文章并排序
const allBlogs = await getCollection("blog");
const sortedBlogs = allBlogs
  .filter((post) => !post.data.draft)
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 5); // 只取最新的5篇
---

<BaseLayout title="Home">
  <MainCard
    title="Welcome"
    description="Explore my blog"
    image={imageLiang}
    infoIcon="lucide:info"
  >
    <div class="space-y-8">
      <!-- Hero Section -->
      <section class="py-6">
        <div class="flex flex-col items-center text-center">
          <h1
            class="text-4xl font-bold mb-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent leading-loose"
          >
            欢迎来到我的个人博客！
          </h1>
          <p class="text-xl text-base-content/80 max-w-3xl mb-8">
            探索我的最新文章和见解
          </p>
          <div class="flex flex-wrap gap-4 justify-center">
            <a href="/blog" class="btn btn-primary gap-2 btn-shine-effect">
              <Icon name="lucide:book-open" class="w-5 h-5" />
              <span>Read Articles</span>
            </a>
            <a href="/about" class="btn btn-outline gap-2">
              <Icon name="lucide:user" class="w-5 h-5" />
              <span>About Me</span>
            </a>
          </div>
        </div>
      </section>

      <!-- Latest Articles -->
      <section class="py-6">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
          <Icon name="lucide:book-open" class="w-6 h-6 text-primary" />
          <span>Latest Articles</span>
        </h2>

        {sortedBlogs.length > 0 ? (
          <div class="space-y-4">
            {sortedBlogs.map((post) => (
              <a
                href={`/blog/${post.slug}`}
                class="card bg-base-200 hover:shadow-lg transition-all duration-300 p-4"
              >
                <div class="flex flex-col sm:flex-row gap-4">
                  {post.data.image && (
                    <img
                      src={post.data.image}
                      alt={post.data.title}
                      class="w-full sm:w-32 h-24 object-cover rounded-lg flex-shrink-0"
                    />
                  )}
                  <div class="flex-1 min-w-0">
                    <h3 class="text-lg font-bold mb-2 line-clamp-2">{post.data.title}</h3>
                    <p class="text-base-content/70 text-sm line-clamp-2 mb-3">{post.data.description}</p>
                    <div class="flex flex-wrap gap-2 text-xs">
                      <span class="text-base-content/50">
                        {new Date(post.data.pubDate).toLocaleDateString()}
                      </span>
                      {post.data.categories && post.data.categories.length > 0 && (
                        <div class="flex gap-2">
                          {post.data.categories.map((cat: string) => (
                            <span class="badge badge-primary badge-sm">
                              {cat}
                            </span>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </a>
            ))}
          </div>
        ) : (
          <div class="alert bg-base-200">
            <Icon name="lucide:info" class="w-6 h-6" />
            <span>No articles published yet. Start writing your first blog post!</span>
          </div>
        )}

        <a href="/blog" class="btn btn-primary mt-6 w-full sm:w-auto">
          <Icon name="lucide:arrow-right" class="w-5 h-5" />
          <span>View All Articles</span>
        </a>
      </section>

    </div>
  </MainCard>
</BaseLayout>
